<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FIDEPROTA STORE - Produtos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #121212;
      color: #ddd;
    }
    /* Scrollbar for product grid */
    .scrollbar-thin::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background-color: #7c3aed;
      border-radius: 3px;
    }
    /* Custom input placeholder color */
    ::placeholder {
      color: #a78bfa;
      opacity: 1;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <!-- HEADER -->
  <header class="bg-black border-b border-purple-800 sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16">
      <a href="index.html" class="text-purple-500 font-extrabold text-3xl tracking-wide select-none">MinhaLoja</a>

      <form id="searchForm" class="flex flex-1 max-w-lg mx-6" role="search" aria-label="Pesquisar produtos">
        <input
          type="search"
          id="searchInput"
          name="search"
          placeholder="Buscar produtos..."
          class="w-full rounded-l-md bg-gray-900 border border-purple-700 text-purple-300 placeholder-purple-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 px-4 py-2"
          aria-describedby="searchHelp"
          autocomplete="off"
        />
        <button
          type="submit"
          class="bg-purple-600 hover:bg-purple-700 text-white px-4 rounded-r-md transition-colors flex items-center justify-center"
          aria-label="Buscar"
        >
          <i class="fas fa-search"></i>
        </button>
      </form>

      <nav class="flex items-center space-x-6">
        <a href="create-account.html" class="text-purple-400 hover:text-purple-600 font-semibold transition-colors" aria-label="Criar conta">Criar Conta</a>

        <button id="cartBtn" aria-label="Abrir carrinho de compras" class="relative text-purple-400 hover:text-purple-600 focus:outline-none focus:ring-2 focus:ring-purple-500 rounded-md">
          <i class="fas fa-shopping-cart fa-lg"></i>
          <span id="cartCount" class="absolute -top-2 -right-2 bg-purple-600 text-white rounded-full text-xs w-5 h-5 flex items-center justify-center font-semibold select-none">0</span>
        </button>
      </nav>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <h2 class="text-4xl font-extrabold text-purple-500 mb-10 text-center tracking-wide">Produtos por Categoria</h2>
    <div id="categories-container" class="space-y-14 scrollbar-thin max-h-[75vh] overflow-y-auto pr-2"></div>
  </main>

  <!-- FOOTER -->
  <footer class="bg-black border-t border-purple-800 py-6 mt-12">
    <div class="max-w-7xl mx-auto px-4 text-center text-purple-400 text-sm select-none">
      &copy; 2025 FIDEPROTA STORE. Todos os direitos reservados.
    </div>
  </footer>

  <!-- MODAL DE COMPRA -->
  <div id="purchaseModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
    <div class="bg-gray-900 rounded-lg max-w-lg w-full p-6 relative shadow-lg text-purple-300 max-h-[90vh] overflow-y-auto">
      <button id="purchaseModalClose" class="absolute top-3 right-3 text-purple-400 hover:text-purple-600 text-3xl font-bold focus:outline-none" aria-label="Fechar modal">&times;</button>
      <h3 id="purchaseModalTitle" class="text-2xl font-extrabold mb-5 text-purple-500"></h3>

      <div id="purchaseProductInfo" class="flex flex-col items-center mb-6">
        <img id="purchaseProductImage" src="" alt="" class="w-48 h-48 object-cover rounded-md mb-4 border border-purple-700" />
        <p id="purchaseProductPrice" class="text-3xl font-bold text-purple-400"></p>
      </div>

      <form id="purchaseForm" class="space-y-5" novalidate>
        <fieldset class="space-y-2">
          <legend class="font-semibold text-purple-400">Método de Pagamento</legend>
          <select id="paymentMethod" name="paymentMethod" class="w-full bg-gray-800 border border-purple-700 rounded-md p-3 text-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500" required>
            <option value="pix">PIX</option>
            <option value="credit_card">Cartão de Crédito</option>
          </select>
        </fieldset>

        <div id="paymentFieldsContainer" class="space-y-4"></div>

        <fieldset class="space-y-2">
          <legend class="font-semibold text-purple-400">Dados para Entrega</legend>
          <input
            type="text"
            id="deliveryName"
            name="deliveryName"
            placeholder="Nome completo"
            class="w-full bg-gray-800 border border-purple-700 rounded-md p-3 text-purple-300 placeholder-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500"
            required
            autocomplete="name"
          />
          <input
            type="text"
            id="deliveryAddress"
            name="deliveryAddress"
            placeholder="Endereço completo"
            class="w-full bg-gray-800 border border-purple-700 rounded-md p-3 text-purple-300 placeholder-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500"
            required
            autocomplete="street-address"
          />
          <input
            type="tel"
            id="deliveryPhone"
            name="deliveryPhone"
            placeholder="Telefone para contato"
            class="w-full bg-gray-800 border border-purple-700 rounded-md p-3 text-purple-300 placeholder-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500"
            required
            autocomplete="tel"
            pattern="[\d\s()+-]+"
            title="Digite um telefone válido"
          />
        </fieldset>

        <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-extrabold py-3 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-purple-500">
          Finalizar Compra
        </button>

        <p id="purchaseStatus" class="mt-4 text-center text-sm"></p>
      </form>
    </div>
  </div>

  <!-- MODAL DE CONFIRMAÇÃO DE RECEBIMENTO -->
  <div id="deliveryModal" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 hidden">
    <div class="bg-gray-900 rounded-lg max-w-md w-full p-8 relative shadow-lg text-purple-300 text-center">
      <button id="deliveryModalClose" class="absolute top-3 right-3 text-purple-400 hover:text-purple-600 text-3xl font-bold focus:outline-none" aria-label="Fechar modal">&times;</button>
      <i class="fas fa-box-open fa-6x mb-6 text-purple-500"></i>
      <h3 class="text-3xl font-extrabold mb-4">Recebimento Confirmado</h3>
      <p class="mb-6 text-purple-400">Obrigado por confirmar o recebimento do seu pedido! Esperamos vê-lo novamente em breve.</p>
      <button id="deliveryModalOkBtn" class="bg-purple-600 hover:bg-purple-700 text-white font-extrabold py-3 px-8 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-purple-500">
        Fechar
      </button>
    </div>
  </div>

  <!-- CARRINHO LATERAL -->
  <aside id="cartSidebar" class="fixed top-0 right-0 h-full w-96 max-w-full bg-gray-900 shadow-lg transform translate-x-full transition-transform z-50 flex flex-col">
    <header class="flex items-center justify-between p-5 border-b border-purple-700">
      <h2 class="text-purple-500 font-extrabold text-2xl">Carrinho</h2>
      <button id="cartCloseBtn" aria-label="Fechar carrinho" class="text-purple-400 hover:text-purple-600 focus:outline-none text-2xl font-bold">&times;</button>
    </header>
    <div id="cartItemsContainer" class="flex-grow overflow-y-auto p-5 space-y-4 scrollbar-thin">
      <!-- Itens do carrinho -->
    </div>
    <footer class="p-5 border-t border-purple-700">
      <div class="flex justify-between items-center mb-4">
        <span class="text-purple-400 font-semibold text-lg">Total:</span>
        <span id="cartTotal" class="text-purple-500 font-extrabold text-xl">R$ 0,00</span>
      </div>
      <button id="cartCheckoutBtn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-extrabold py-3 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-purple-500 disabled:opacity-50" disabled>
        Finalizar Compra
      </button>
    </footer>
  </aside>

  <script>
    // Chave da API Pushin Pay
    const pushinPayKey = "SUA_KEY_AQUI";

    // Dados da loja (carregados do localStorage ou inicializados)
    let storeData = [];
    let filteredStoreData = [];
    let cart = [];

    // Elementos DOM
    const categoriesContainer = document.getElementById('categories-container');
    const purchaseModal = document.getElementById('purchaseModal');
    const purchaseModalClose = document.getElementById('purchaseModalClose');
    const purchaseModalTitle = document.getElementById('purchaseModalTitle');
    const purchaseProductImage = document.getElementById('purchaseProductImage');
    const purchaseProductPrice = document.getElementById('purchaseProductPrice');
    const purchaseForm = document.getElementById('purchaseForm');
    const paymentMethodSelect = document.getElementById('paymentMethod');
    const paymentFieldsContainer = document.getElementById('paymentFieldsContainer');
    const purchaseStatus = document.getElementById('purchaseStatus');
    const deliveryNameInput = document.getElementById('deliveryName');
    const deliveryAddressInput = document.getElementById('deliveryAddress');
    const deliveryPhoneInput = document.getElementById('deliveryPhone');

    const cartBtn = document.getElementById('cartBtn');
    const cartSidebar = document.getElementById('cartSidebar');
    const cartCloseBtn = document.getElementById('cartCloseBtn');
    const cartItemsContainer = document.getElementById('cartItemsContainer');
    const cartCount = document.getElementById('cartCount');
    const cartTotal = document.getElementById('cartTotal');
    const cartCheckoutBtn = document.getElementById('cartCheckoutBtn');

    const searchForm = document.getElementById('searchForm');
    const searchInput = document.getElementById('searchInput');

    const deliveryModal = document.getElementById('deliveryModal');
    const deliveryModalClose = document.getElementById('deliveryModalClose');
    const deliveryModalOkBtn = document.getElementById('deliveryModalOkBtn');

    // Produto selecionado para compra
    let currentProduct = null;

    // Função para formatar preço em BRL
    function formatPriceBRL(value) {
      return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    // Função para carregar dados do localStorage
    function loadData() {
      const data = localStorage.getItem('storeData');
      if (!data) {
        // Dados iniciais
        storeData = [
          {
            id: 'cat1',
            name: 'Eletrônicos',
            products: [
              {
                id: 'prod1',
                name: 'Smartphone XYZ',
                description: 'Smartphone moderno com tela AMOLED de 6.5 polegadas e câmera tripla.',
                image: 'https://placehold.co/400x300/png?text=Smartphone+XYZ',
                price: 1999.9,
              },
              {
                id: 'prod2',
                name: 'Fone de Ouvido Bluetooth',
                description: 'Fone sem fio com cancelamento de ruído e bateria de longa duração.',
                image: 'https://placehold.co/400x300/png?text=Fone+de+Ouvido+Bluetooth',
                price: 299.9,
              },
            ],
          },
          {
            id: 'cat2',
            name: 'Roupas',
            products: [
              {
                id: 'prod3',
                name: 'Camiseta Básica',
                description: 'Camiseta 100% algodão, confortável e disponível em várias cores.',
                image: 'https://placehold.co/400x300/png?text=Camiseta+Básica',
                price: 49.9,
              },
              {
                id: 'prod4',
                name: 'Jaqueta Jeans',
                description: 'Jaqueta jeans estilosa e resistente para todas as estações.',
                image: 'https://placehold.co/400x300/png?text=Jaqueta+Jeans',
                price: 159.9,
              },
            ],
          },
          {
            id: 'cat3',
            name: 'Livros',
            products: [
              {
                id: 'prod5',
                name: 'Aprendendo JavaScript',
                description: 'Livro completo para iniciantes em JavaScript e desenvolvimento web.',
                image: 'https://placehold.co/400x300/png?text=Aprendendo+JavaScript',
                price: 79.9,
              },
              {
                id: 'prod6',
                name: 'Design para Todos',
                description: 'Guia prático de design gráfico para iniciantes e profissionais.',
                image: 'https://placehold.co/400x300/png?text=Design+para+Todos',
                price: 89.9,
              },
            ],
          },
        ];
        localStorage.setItem('storeData', JSON.stringify(storeData));
      } else {
        storeData = JSON.parse(data);
      }
      filteredStoreData = JSON.parse(JSON.stringify(storeData));
    }

    // Função para salvar dados no localStorage
    function saveData() {
      localStorage.setItem('storeData', JSON.stringify(storeData));
    }

    // Renderiza categorias e produtos filtrados
    function renderCategories(categories) {
      categoriesContainer.innerHTML = '';
      if (categories.length === 0) {
        const emptyMsg = document.createElement('p');
        emptyMsg.className = 'text-center text-purple-400 text-lg italic select-none';
        emptyMsg.textContent = 'Nenhuma categoria ou produto disponível.';
        categoriesContainer.appendChild(emptyMsg);
        return;
      }

      categories.forEach((category) => {
        const categorySection = document.createElement('section');
        categorySection.className = 'space-y-5';

        const categoryTitle = document.createElement('h3');
        categoryTitle.className = 'text-3xl font-extrabold text-purple-500 border-b border-purple-700 pb-2 tracking-wide select-none';
        categoryTitle.textContent = category.name;

        const productsGrid = document.createElement('div');
        productsGrid.className = 'grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8';

        if (category.products.length === 0) {
          const noProducts = document.createElement('p');
          noProducts.className = 'text-purple-400 italic col-span-full select-none';
          noProducts.textContent = 'Nenhum produto nesta categoria.';
          productsGrid.appendChild(noProducts);
        } else {
          category.products.forEach((product) => {
            const card = document.createElement('article');
            card.className = 'bg-gray-900 rounded-xl shadow-lg flex flex-col hover:shadow-purple-700 transition-shadow cursor-pointer select-none';

            const img = document.createElement('img');
            img.src = product.image;
            img.alt = product.name + ' - imagem do produto';
            img.className = 'w-full h-52 object-cover rounded-t-xl border-b border-purple-700';

            const cardBody = document.createElement('div');
            cardBody.className = 'p-5 flex flex-col flex-grow';

            const productName = document.createElement('h4');
            productName.className = 'text-xl font-extrabold text-purple-400 mb-2 truncate';
            productName.textContent = product.name;

            const productDesc = document.createElement('p');
            productDesc.className = 'text-purple-300 text-sm flex-grow mb-4';
            productDesc.textContent = product.description;

            const price = document.createElement('p');
            price.className = 'text-purple-500 font-extrabold text-2xl mb-4';
            price.textContent = formatPriceBRL(product.price);

            const buyBtn = document.createElement('button');
            buyBtn.className = 'mt-auto bg-purple-600 hover:bg-purple-700 text-white font-extrabold py-3 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-purple-500 flex items-center justify-center space-x-2';
            buyBtn.innerHTML = '<i class="fas fa-cart-plus"></i><span>Adicionar ao Carrinho</span>';
            buyBtn.onclick = (e) => {
              e.stopPropagation();
              addToCart(product);
            };

            cardBody.appendChild(productName);
            cardBody.appendChild(productDesc);
            cardBody.appendChild(price);
            cardBody.appendChild(buyBtn);

            card.appendChild(img);
            card.appendChild(cardBody);

            productsGrid.appendChild(card);
          });
        }

        categorySection.appendChild(categoryTitle);
        categorySection.appendChild(productsGrid);
        categoriesContainer.appendChild(categorySection);
      });
    }

    // Função para adicionar produto ao carrinho
    function addToCart(product) {
      const existing = cart.find((item) => item.product.id === product.id);
      if (existing) {
        existing.quantity++;
      } else {
        cart.push({ product, quantity: 1 });
      }
      updateCartUI();
      openCart();
    }

    // Atualiza UI do carrinho
    function updateCartUI() {
      cartItemsContainer.innerHTML = '';
      if (cart.length === 0) {
        const emptyMsg = document.createElement('p');
        emptyMsg.className = 'text-purple-400 text-center italic select-none';
        emptyMsg.textContent = 'Seu carrinho está vazio.';
        cartItemsContainer.appendChild(emptyMsg);
        cartCount.textContent = '0';
        cartCheckoutBtn.disabled = true;
        cartTotal.textContent = 'R$ 0,00';
        return;
      }

      let total = 0;
      let totalQuantity = 0;

      cart.forEach(({ product, quantity }, index) => {
        total += product.price * quantity;
        totalQuantity += quantity;

        const itemDiv = document.createElement('div');
        itemDiv.className = 'flex items-center space-x-4';

        const img = document.createElement('img');
        img.src = product.image;
        img.alt = product.name + ' - imagem do produto no carrinho';
        img.className = 'w-16 h-16 object-cover rounded-md border border-purple-700 flex-shrink-0';

        const infoDiv = document.createElement('div');
        infoDiv.className = 'flex-grow min-w-0';

        const nameP = document.createElement('p');
        nameP.className = 'text-purple-300 font-semibold truncate';
        nameP.textContent = product.name;

        const priceP = document.createElement('p');
        priceP.className = 'text-purple-500 font-bold';
        priceP.textContent = formatPriceBRL(product.price);

        infoDiv.appendChild(nameP);
        infoDiv.appendChild(priceP);

        const qtyDiv = document.createElement('div');
        qtyDiv.className = 'flex items-center space-x-2';

        const btnMinus = document.createElement('button');
        btnMinus.className = 'text-purple-400 hover:text-purple-600 focus:outline-none';
        btnMinus.setAttribute('aria-label', `Diminuir quantidade de ${product.name}`);
        btnMinus.innerHTML = '<i class="fas fa-minus-circle fa-lg"></i>';
        btnMinus.onclick = () => {
          if (cart[index].quantity > 1) {
            cart[index].quantity--;
          } else {
            cart.splice(index, 1);
          }
          updateCartUI();
        };

        const qtySpan = document.createElement('span');
        qtySpan.className = 'text-purple-300 font-semibold w-6 text-center select-none';
        qtySpan.textContent = quantity;

        const btnPlus = document.createElement('button');
        btnPlus.className = 'text-purple-400 hover:text-purple-600 focus:outline-none';
        btnPlus.setAttribute('aria-label', `Aumentar quantidade de ${product.name}`);
        btnPlus.innerHTML = '<i class="fas fa-plus-circle fa-lg"></i>';
        btnPlus.onclick = () => {
          cart[index].quantity++;
          updateCartUI();
        };

        qtyDiv.appendChild(btnMinus);
        qtyDiv.appendChild(qtySpan);
        qtyDiv.appendChild(btnPlus);

        itemDiv.appendChild(img);
        itemDiv.appendChild(infoDiv);
        itemDiv.appendChild(qtyDiv);

        cartItemsContainer.appendChild(itemDiv);
      });

      cartCount.textContent = totalQuantity;
      cartTotal.textContent = formatPriceBRL(total);
      cartCheckoutBtn.disabled = false;
    }

    // Abrir carrinho
    function openCart() {
      cartSidebar.classList.remove('translate-x-full');
      cartSidebar.classList.add('translate-x-0');
      cartBtn.setAttribute('aria-expanded', 'true');
    }

    // Fechar carrinho
    function closeCart() {
      cartSidebar.classList.add('translate-x-full');
      cartSidebar.classList.remove('translate-x-0');
      cartBtn.setAttribute('aria-expanded', 'false');
    }

    // Abrir modal de compra para o produto selecionado (não mais usado, compra via carrinho)
    // Mantido para referência futura, mas compra será via carrinho

    // Renderiza campos de pagamento conforme método
    function renderPaymentFields(method) {
      paymentFieldsContainer.innerHTML = '';
      if (method === 'pix') {
        const pixInfo = document.createElement('p');
        pixInfo.className = 'text-purple-400';
        pixInfo.textContent = 'Você será redirecionado para realizar o pagamento via PIX após finalizar a compra.';
        paymentFieldsContainer.appendChild(pixInfo);
      } else if (method === 'credit_card') {
        // Cartão de crédito fields
        const cardNumberLabel = document.createElement('label');
        cardNumberLabel.className = 'block text-purple-400 font-semibold mb-1';
        cardNumberLabel.textContent = 'Número do Cartão';

        const cardNumberInput = document.createElement('input');
        cardNumberInput.type = 'text';
        cardNumberInput.placeholder = '1234 5678 9012 3456';
        cardNumberInput.className = 'w-full bg-gray-800 border border-purple-700 rounded-md p-3 mb-3 text-purple-300 placeholder-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500';
        cardNumberInput.maxLength = 19;
        cardNumberInput.pattern = '[0-9 ]+';
        cardNumberInput.required = true;
        cardNumberInput.autocomplete = 'cc-number';

        const cardNameLabel = document.createElement('label');
        cardNameLabel.className = 'block text-purple-400 font-semibold mb-1';
        cardNameLabel.textContent = 'Nome no Cartão';

        const cardNameInput = document.createElement('input');
        cardNameInput.type = 'text';
        cardNameInput.placeholder = 'Nome como no cartão';
        cardNameInput.className = 'w-full bg-gray-800 border border-purple-700 rounded-md p-3 mb-3 text-purple-300 placeholder-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500';
        cardNameInput.required = true;
        cardNameInput.autocomplete = 'cc-name';

        const cardExpiryLabel = document.createElement('label');
        cardExpiryLabel.className = 'block text-purple-400 font-semibold mb-1';
        cardExpiryLabel.textContent = 'Validade (MM/AA)';

        const cardExpiryInput = document.createElement('input');
        cardExpiryInput.type = 'text';
        cardExpiryInput.placeholder = 'MM/AA';
        cardExpiryInput.className = 'w-1/2 bg-gray-800 border border-purple-700 rounded-md p-3 mb-3 text-purple-300 placeholder-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500';
        cardExpiryInput.maxLength = 5;
        cardExpiryInput.required = true;
        cardExpiryInput.autocomplete = 'cc-exp';

        const cardCvvLabel = document.createElement('label');
        cardCvvLabel.className = 'block text-purple-400 font-semibold mb-1';
        cardCvvLabel.textContent = 'CVV';

        const cardCvvInput = document.createElement('input');
        cardCvvInput.type = 'password';
        cardCvvInput.placeholder = '123';
        cardCvvInput.className = 'w-1/3 bg-gray-800 border border-purple-700 rounded-md p-3 mb-3 text-purple-300 placeholder-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500';
        cardCvvInput.maxLength = 4;
        cardCvvInput.required = true;
        cardCvvInput.autocomplete = 'cc-csc';

        paymentFieldsContainer.appendChild(cardNumberLabel);
        paymentFieldsContainer.appendChild(cardNumberInput);
        paymentFieldsContainer.appendChild(cardNameLabel);
        paymentFieldsContainer.appendChild(cardNameInput);
        paymentFieldsContainer.appendChild(cardExpiryLabel);
        paymentFieldsContainer.appendChild(cardExpiryInput);
        paymentFieldsContainer.appendChild(cardCvvLabel);
        paymentFieldsContainer.appendChild(cardCvvInput);
      }
    }

    // Evento para mudar campos de pagamento
    paymentMethodSelect.addEventListener('change', (e) => {
      renderPaymentFields(e.target.value);
    });

    // Evento fechar modal compra
    purchaseModalClose.addEventListener('click', () => {
      closePurchaseModal();
    });

    // Função para abrir modal compra (não usado diretamente, compra via carrinho)
    function openPurchaseModal(product) {
      currentProduct = product;
      purchaseModalTitle.textContent = `Comprar: ${product.name}`;
      purchaseProductImage.src = product.image;
      purchaseProductImage.alt = product.name + ' - imagem do produto para compra';
      purchaseProductPrice.textContent = formatPriceBRL(product.price);
      purchaseStatus.textContent = '';
      purchaseForm.reset();
      renderPaymentFields('pix');
      purchaseModal.classList.remove('hidden');
      deliveryNameInput.focus();
    }

    // Função para fechar modal compra
    function closePurchaseModal() {
      purchaseModal.classList.add('hidden');
      currentProduct = null;
    }

    // Função para validar telefone simples
    function isValidPhone(phone) {
      return /^[\d\s()+-]{8,}$/.test(phone.trim());
    }

    // Função para processar pagamento (simulado)
    async function processPayment(paymentData, deliveryData) {
      purchaseStatus.textContent = '';
      purchaseStatus.className = 'mt-4 text-center text-purple-400';

      // Simula delay da API
      purchaseStatus.textContent = 'Processando pagamento...';
      await new Promise((r) => setTimeout(r, 2000));

      // Aqui você faria a chamada real para a API Pushin Pay usando fetch ou axios
      // Exemplo (simulado):
      // fetch('https://api.pushinpay.com/payment', { method: 'POST', headers: {...}, body: JSON.stringify({...}) })

      // Simulação de sucesso
      const success = true;

      if (success) {
        purchaseStatus.className = 'mt-4 text-center text-green-500 font-bold';
        purchaseStatus.textContent = 'Pagamento aprovado! Por favor, confirme o recebimento do produto.';

        // Limpa carrinho dos produtos comprados
        cart = [];
        updateCartUI();

        // Fecha modal compra após 2s e abre modal confirmação recebimento
        setTimeout(() => {
          closePurchaseModal();
          openDeliveryModal();
        }, 2000);
      } else {
        purchaseStatus.className = 'mt-4 text-center text-red-600 font-bold';
        purchaseStatus.textContent = 'Erro ao processar o pagamento. Tente novamente.';
      }
    }

    // Evento submit do formulário de compra (via carrinho)
    purchaseForm.addEventListener('submit', (e) => {
      e.preventDefault();

      if (cart.length === 0) {
        purchaseStatus.className = 'mt-4 text-center text-red-600 font-bold';
        purchaseStatus.textContent = 'Seu carrinho está vazio.';
        return;
      }

      const paymentMethod = paymentMethodSelect.value;
      const deliveryName = deliveryNameInput.value.trim();
      const deliveryAddress = deliveryAddressInput.value.trim();
      const deliveryPhone = deliveryPhoneInput.value.trim();

      if (!deliveryName) {
        purchaseStatus.className = 'mt-4 text-center text-red-600 font-bold';
        purchaseStatus.textContent = 'Por favor, informe o nome para entrega.';
        deliveryNameInput.focus();
        return;
      }
      if (!deliveryAddress) {
        purchaseStatus.className = 'mt-4 text-center text-red-600 font-bold';
        purchaseStatus.textContent = 'Por favor, informe o endereço para entrega.';
        deliveryAddressInput.focus();
        return;
      }
      if (!deliveryPhone || !isValidPhone(deliveryPhone)) {
        purchaseStatus.className = 'mt-4 text-center text-red-600 font-bold';
        purchaseStatus.textContent = 'Por favor, informe um telefone válido para contato.';
        deliveryPhoneInput.focus();
        return;
      }

      // Valida campos do cartão se método for cartão
      if (paymentMethod === 'credit_card') {
        const cardNumber = paymentFieldsContainer.querySelector('input[placeholder="1234 5678 9012 3456"]');
        const cardName = paymentFieldsContainer.querySelector('input[placeholder="Nome como no cartão"]');
        const cardExpiry = paymentFieldsContainer.querySelector('input[placeholder="MM/AA"]');
        const cardCvv = paymentFieldsContainer.querySelector('input[placeholder="123"]');

        if (!cardNumber.value.trim() || !cardName.value.trim() || !cardExpiry.value.trim() || !cardCvv.value.trim()) {
          purchaseStatus.className = 'mt-4 text-center text-red-600 font-bold';
          purchaseStatus.textContent = 'Por favor, preencha todos os campos do cartão.';
          return;
        }
      }

      // Dados para envio à API (simulado)
      const paymentData = {
        method: paymentMethod,
        cart: cart.map(({ product, quantity }) => ({
          id: product.id,
          name: product.name,
          price: product.price,
          quantity,
        })),
      };
      const deliveryData = {
        name: deliveryName,
        address: deliveryAddress,
        phone: deliveryPhone,
      };

      processPayment(paymentData, deliveryData);
    });

    // Eventos do carrinho
    cartBtn.addEventListener('click', () => {
      openCart();
    });
    cartCloseBtn.addEventListener('click', () => {
      closeCart();
    });

    // Checkout do carrinho abre modal compra
    cartCheckoutBtn.addEventListener('click', () => {
      if (cart.length === 0) return;
      closeCart();
      openPurchaseModal(null); // null pois compra é do carrinho todo
      // Preenche modal com resumo do carrinho
      purchaseModalTitle.textContent = 'Finalizar Compra';
      purchaseProductImage.src = '';
      purchaseProductImage.alt = '';
      purchaseProductPrice.textContent = '';
      purchaseStatus.textContent = '';
      purchaseForm.reset();
      renderPaymentFields('pix');
      purchaseModal.classList.remove('hidden');
      deliveryNameInput.focus();
    });

    // Pesquisa produtos
    searchForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const query = searchInput.value.trim().toLowerCase();
      if (!query) {
        filteredStoreData = JSON.parse(JSON.stringify(storeData));
        renderCategories(filteredStoreData);
        return;
      }
      // Filtra categorias e produtos que contenham o termo
      filteredStoreData = storeData
        .map((category) => {
          const filteredProducts = category.products.filter((p) =>
            p.name.toLowerCase().includes(query) || p.description.toLowerCase().includes(query)
          );
          if (filteredProducts.length > 0) {
            return {
              ...category,
              products: filteredProducts,
            };
          }
          return null;
        })
        .filter(Boolean);
      renderCategories(filteredStoreData);
    });

    // Modal confirmação recebimento
    function openDeliveryModal() {
      deliveryModal.classList.remove('hidden');
      deliveryModalOkBtn.focus();
    }
    function closeDeliveryModal() {
      deliveryModal.classList.add('hidden');
    }
    deliveryModalClose.addEventListener('click', closeDeliveryModal);
    deliveryModalOkBtn.addEventListener('click', closeDeliveryModal);

    // Inicialização
    document.addEventListener('DOMContentLoaded', () => {
      loadData();
      renderCategories(storeData);
      updateCartUI();
    });

    // Fechar modais com ESC
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (!purchaseModal.classList.contains('hidden')) closePurchaseModal();
        if (!deliveryModal.classList.contains('hidden')) closeDeliveryModal();
        if (!cartSidebar.classList.contains('translate-x-full')) closeCart();
      }
    });
  </script>
</body>
</html>
