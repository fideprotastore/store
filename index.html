<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Loja - Produtos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
  <header class="bg-white shadow-md sticky top-0 z-30">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center h-16">
      <h1 class="text-2xl font-semibold text-indigo-600">Minha Loja</h1>
      <nav>
        <a href="index.html" class="text-gray-700 hover:text-indigo-600 font-medium px-3 py-2 rounded-md">Loja</a>
        <a href="admin.html" class="text-gray-700 hover:text-indigo-600 font-medium px-3 py-2 rounded-md">Painel Admin</a>
      </nav>
    </div>
  </header>

  <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h2 class="text-3xl font-semibold text-gray-800 mb-8 text-center">Produtos por Categoria</h2>
    <div id="categories-container" class="space-y-12"></div>
  </main>

  <footer class="bg-white border-t border-gray-200 py-6 mt-12">
    <div class="max-w-7xl mx-auto px-4 text-center text-gray-500 text-sm">
      &copy; 2024 Minha Loja. Todos os direitos reservados.
    </div>
  </footer>

  <script>
    // Chave da API Pushin Pay
    const pushinPayKey = "SUA_KEY_AQUI";

    // Função para formatar preço em BRL
    function formatPriceBRL(value) {
      return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    // Função para criar o modal de compra
    function createPurchaseModal(product) {
      // Cria o modal container
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';

      // Modal content container
      const modalContent = document.createElement('div');
      modalContent.className = 'bg-white rounded-lg max-w-md w-full p-6 relative shadow-lg';

      // Close button
      const closeBtn = document.createElement('button');
      closeBtn.className = 'absolute top-3 right-3 text-gray-500 hover:text-gray-700 text-xl';
      closeBtn.innerHTML = '&times;';
      closeBtn.setAttribute('aria-label', 'Fechar modal');
      closeBtn.onclick = () => document.body.removeChild(modal);

      // Title
      const title = document.createElement('h3');
      title.className = 'text-xl font-semibold mb-4 text-gray-800';
      title.textContent = `Comprar: ${product.name}`;

      // Product info
      const productInfo = document.createElement('div');
      productInfo.className = 'mb-4 flex flex-col items-center';
      const img = document.createElement('img');
      img.src = product.image;
      img.alt = product.name + ' - imagem do produto para compra';
      img.className = 'w-40 h-40 object-cover rounded-md mb-3';
      const price = document.createElement('p');
      price.className = 'text-lg font-semibold text-indigo-600';
      price.textContent = formatPriceBRL(product.price);
      productInfo.appendChild(img);
      productInfo.appendChild(price);

      // Payment method selection
      const paymentLabel = document.createElement('label');
      paymentLabel.className = 'block mb-2 font-medium text-gray-700';
      paymentLabel.textContent = 'Selecione o método de pagamento:';

      const paymentSelect = document.createElement('select');
      paymentSelect.className = 'w-full border border-gray-300 rounded-md p-2 mb-4 focus:outline-none focus:ring-2 focus:ring-indigo-500';
      paymentSelect.innerHTML = `
        <option value="pix">PIX</option>
        <option value="credit_card">Cartão de Crédito</option>
      `;

      // Container for payment form fields
      const paymentFieldsContainer = document.createElement('div');

      // Função para renderizar campos conforme método
      function renderPaymentFields(method) {
        paymentFieldsContainer.innerHTML = '';
        if (method === 'pix') {
          const pixInfo = document.createElement('p');
          pixInfo.className = 'text-gray-700 mb-4';
          pixInfo.textContent = 'Você será redirecionado para realizar o pagamento via PIX.';
          paymentFieldsContainer.appendChild(pixInfo);
        } else if (method === 'credit_card') {
          // Cartão de crédito fields
          const cardNumberLabel = document.createElement('label');
          cardNumberLabel.className = 'block text-gray-700 font-medium mb-1';
          cardNumberLabel.textContent = 'Número do Cartão';

          const cardNumberInput = document.createElement('input');
          cardNumberInput.type = 'text';
          cardNumberInput.placeholder = '1234 5678 9012 3456';
          cardNumberInput.className = 'w-full border border-gray-300 rounded-md p-2 mb-3 focus:outline-none focus:ring-2 focus:ring-indigo-500';
          cardNumberInput.maxLength = 19;
          cardNumberInput.pattern = '[0-9 ]+';
          cardNumberInput.required = true;

          const cardNameLabel = document.createElement('label');
          cardNameLabel.className = 'block text-gray-700 font-medium mb-1';
          cardNameLabel.textContent = 'Nome no Cartão';

          const cardNameInput = document.createElement('input');
          cardNameInput.type = 'text';
          cardNameInput.placeholder = 'Nome como no cartão';
          cardNameInput.className = 'w-full border border-gray-300 rounded-md p-2 mb-3 focus:outline-none focus:ring-2 focus:ring-indigo-500';
          cardNameInput.required = true;

          const cardExpiryLabel = document.createElement('label');
          cardExpiryLabel.className = 'block text-gray-700 font-medium mb-1';
          cardExpiryLabel.textContent = 'Validade (MM/AA)';

          const cardExpiryInput = document.createElement('input');
          cardExpiryInput.type = 'text';
          cardExpiryInput.placeholder = 'MM/AA';
          cardExpiryInput.className = 'w-1/2 border border-gray-300 rounded-md p-2 mb-3 focus:outline-none focus:ring-2 focus:ring-indigo-500';
          cardExpiryInput.maxLength = 5;
          cardExpiryInput.required = true;

          const cardCvvLabel = document.createElement('label');
          cardCvvLabel.className = 'block text-gray-700 font-medium mb-1';
          cardCvvLabel.textContent = 'CVV';

          const cardCvvInput = document.createElement('input');
          cardCvvInput.type = 'password';
          cardCvvInput.placeholder = '123';
          cardCvvInput.className = 'w-1/3 border border-gray-300 rounded-md p-2 mb-3 focus:outline-none focus:ring-2 focus:ring-indigo-500';
          cardCvvInput.maxLength = 4;
          cardCvvInput.required = true;

          paymentFieldsContainer.appendChild(cardNumberLabel);
          paymentFieldsContainer.appendChild(cardNumberInput);
          paymentFieldsContainer.appendChild(cardNameLabel);
          paymentFieldsContainer.appendChild(cardNameInput);
          paymentFieldsContainer.appendChild(cardExpiryLabel);
          paymentFieldsContainer.appendChild(cardExpiryInput);
          paymentFieldsContainer.appendChild(cardCvvLabel);
          paymentFieldsContainer.appendChild(cardCvvInput);
        }
      }

      // Inicializa com PIX
      renderPaymentFields('pix');

      paymentSelect.addEventListener('change', (e) => {
        renderPaymentFields(e.target.value);
      });

      // Buy button
      const buyBtn = document.createElement('button');
      buyBtn.className = 'w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 rounded-md transition-colors';
      buyBtn.textContent = 'Finalizar Compra';

      // Status message
      const statusMsg = document.createElement('p');
      statusMsg.className = 'mt-3 text-center text-sm text-gray-700';

      // Função para simular requisição para Pushin Pay
      async function processPayment() {
        buyBtn.disabled = true;
        buyBtn.textContent = 'Processando...';
        statusMsg.textContent = '';

        // Simulação de delay para requisição
        await new Promise((r) => setTimeout(r, 1500));

        // Aqui você faria a chamada real para a API Pushin Pay usando fetch ou axios
        // Exemplo (simulado):
        // fetch('https://api.pushinpay.com/payment', { method: 'POST', headers: {...}, body: JSON.stringify({...}) })

        // Simulação de sucesso
        const success = true;

        if (success) {
          statusMsg.className = 'mt-3 text-center text-green-600 font-semibold';
          statusMsg.textContent = 'Pagamento realizado com sucesso! Obrigado pela compra.';
          buyBtn.textContent = 'Compra Finalizada';
        } else {
          statusMsg.className = 'mt-3 text-center text-red-600 font-semibold';
          statusMsg.textContent = 'Erro ao processar o pagamento. Tente novamente.';
          buyBtn.textContent = 'Finalizar Compra';
          buyBtn.disabled = false;
        }
      }

      buyBtn.onclick = () => {
        // Validação simples para cartão de crédito
        if (paymentSelect.value === 'credit_card') {
          const inputs = paymentFieldsContainer.querySelectorAll('input');
          for (const input of inputs) {
            if (!input.value.trim()) {
              statusMsg.className = 'mt-3 text-center text-red-600 font-semibold';
              statusMsg.textContent = 'Por favor, preencha todos os campos do cartão.';
              return;
            }
          }
        }
        processPayment();
      };

      modalContent.appendChild(closeBtn);
      modalContent.appendChild(title);
      modalContent.appendChild(productInfo);
      modalContent.appendChild(paymentLabel);
      modalContent.appendChild(paymentSelect);
      modalContent.appendChild(paymentFieldsContainer);
      modalContent.appendChild(buyBtn);
      modalContent.appendChild(statusMsg);

      modal.appendChild(modalContent);
      return modal;
    }

    // Função para renderizar produtos por categoria
    function renderCategories(categories) {
      const container = document.getElementById('categories-container');
      container.innerHTML = '';

      if (categories.length === 0) {
        const emptyMsg = document.createElement('p');
        emptyMsg.className = 'text-center text-gray-500 text-lg';
        emptyMsg.textContent = 'Nenhuma categoria ou produto disponível.';
        container.appendChild(emptyMsg);
        return;
      }

      categories.forEach((category) => {
        const categorySection = document.createElement('section');
        categorySection.className = 'space-y-4';

        const categoryTitle = document.createElement('h3');
        categoryTitle.className = 'text-2xl font-semibold text-indigo-700 border-b border-indigo-300 pb-1';
        categoryTitle.textContent = category.name;

        const productsGrid = document.createElement('div');
        productsGrid.className = 'grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6';

        if (category.products.length === 0) {
          const noProducts = document.createElement('p');
          noProducts.className = 'text-gray-500 italic col-span-full';
          noProducts.textContent = 'Nenhum produto nesta categoria.';
          productsGrid.appendChild(noProducts);
        } else {
          category.products.forEach((product) => {
            const card = document.createElement('article');
            card.className = 'bg-white rounded-lg shadow-md flex flex-col';

            const img = document.createElement('img');
            img.src = product.image;
            img.alt = product.name + ' - imagem do produto';
            img.className = 'w-full h-48 object-cover rounded-t-lg';

            const cardBody = document.createElement('div');
            cardBody.className = 'p-4 flex flex-col flex-grow';

            const productName = document.createElement('h4');
            productName.className = 'text-lg font-semibold text-gray-800 mb-1';
            productName.textContent = product.name;

            const productDesc = document.createElement('p');
            productDesc.className = 'text-gray-600 text-sm flex-grow';
            productDesc.textContent = product.description;

            const price = document.createElement('p');
            price.className = 'text-indigo-600 font-bold mt-3 text-lg';
            price.textContent = formatPriceBRL(product.price);

            const buyBtn = document.createElement('button');
            buyBtn.className = 'mt-4 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 rounded-md transition-colors';
            buyBtn.textContent = 'Comprar';
            buyBtn.onclick = () => {
              const modal = createPurchaseModal(product);
              document.body.appendChild(modal);
            };

            cardBody.appendChild(productName);
            cardBody.appendChild(productDesc);
            cardBody.appendChild(price);
            cardBody.appendChild(buyBtn);

            card.appendChild(img);
            card.appendChild(cardBody);

            productsGrid.appendChild(card);
          });
        }

        categorySection.appendChild(categoryTitle);
        categorySection.appendChild(productsGrid);
        container.appendChild(categorySection);
      });
    }

    // Função para carregar dados do localStorage
    function loadData() {
      const data = localStorage.getItem('storeData');
      if (!data) {
        // Se não existir, cria dados iniciais de exemplo
        const initialData = [
          {
            id: 'cat1',
            name: 'Eletrônicos',
            products: [
              {
                id: 'prod1',
                name: 'Smartphone XYZ',
                description: 'Smartphone moderno com tela AMOLED de 6.5 polegadas e câmera tripla.',
                image: 'https://placehold.co/400x300/png?text=Smartphone+XYZ',
                price: 1999.9,
              },
              {
                id: 'prod2',
                name: 'Fone de Ouvido Bluetooth',
                description: 'Fone sem fio com cancelamento de ruído e bateria de longa duração.',
                image: 'https://placehold.co/400x300/png?text=Fone+de+Ouvido+Bluetooth',
                price: 299.9,
              },
            ],
          },
          {
            id: 'cat2',
            name: 'Roupas',
            products: [
              {
                id: 'prod3',
                name: 'Camiseta Básica',
                description: 'Camiseta 100% algodão, confortável e disponível em várias cores.',
                image: 'https://placehold.co/400x300/png?text=Camiseta+Básica',
                price: 49.9,
              },
              {
                id: 'prod4',
                name: 'Jaqueta Jeans',
                description: 'Jaqueta jeans estilosa e resistente para todas as estações.',
                image: 'https://placehold.co/400x300/png?text=Jaqueta+Jeans',
                price: 159.9,
              },
            ],
          },
          {
            id: 'cat3',
            name: 'Livros',
            products: [
              {
                id: 'prod5',
                name: 'Aprendendo JavaScript',
                description: 'Livro completo para iniciantes em JavaScript e desenvolvimento web.',
                image: 'https://placehold.co/400x300/png?text=Aprendendo+JavaScript',
                price: 79.9,
              },
              {
                id: 'prod6',
                name: 'Design para Todos',
                description: 'Guia prático de design gráfico para iniciantes e profissionais.',
                image: 'https://placehold.co/400x300/png?text=Design+para+Todos',
                price: 89.9,
              },
            ],
          },
        ];
        localStorage.setItem('storeData', JSON.stringify(initialData));
        return initialData;
      }
      return JSON.parse(data);
    }

    // Inicializa a página
    document.addEventListener('DOMContentLoaded', () => {
      const categories = loadData();
      renderCategories(categories);
    });
  </script>
</body>
</html>
